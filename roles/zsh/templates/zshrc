if [[ -z "$ZELLIJ" ]]; then
  zellij attach -c main
fi

# History
HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt inc_append_history
setopt hist_ignore_all_dups

# Reload history before fzf Ctrl+R
fzf-history-widget-with-reload() {
  fc -R
  fzf-history-widget
}
zle -N fzf-history-widget-with-reload

# Zinit
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
source "${ZINIT_HOME}/zinit.zsh"

# Plugins
zinit light zsh-users/zsh-autosuggestions
zinit ice wait lucid
zinit light zsh-users/zsh-completions
zinit ice wait lucid
zinit light zsh-users/zsh-history-substring-search
zinit ice wait lucid
zinit light zdharma-continuum/fast-syntax-highlighting
zinit light Aloxaf/fzf-tab

# Fuzzy completion matching
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}' '+l:|=* r:|=*'

# History substring search bindings
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down

# Load completions (cached, regenerates daily)
autoload -Uz compinit
if [[ -n ~/.zcompdump(#qN.mh+24) ]]; then
  compinit
else
  compinit -C
fi

source ~/.profile

# Initialize zoxide if available
if command -v zoxide >/dev/null 2>&1; then
  eval "$(zoxide init zsh)"
fi

# Initialize fzf if available
if command -v fzf >/dev/null 2>&1; then
  source <(fzf --zsh)
  bindkey '^R' fzf-history-widget-with-reload
fi

# Initialize starship prompt
eval "$(starship init zsh)"

# Aliases
alias cat='bat -p'
alias ls='eza'
alias ll='eza -l'
alias la='eza -la'

export PATH="$HOME/.local/bin:$PATH"
